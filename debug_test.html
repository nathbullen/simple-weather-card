<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Test - Simple Weather Card</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .test-container {
            max-width: 600px;
            margin: 20px auto;
            border: 1px solid #ccc;
            padding: 20px;
            background: white;
            border-radius: 8px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        .debug { background-color: #f8f9fa; color: #495057; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>Debug Test - Simple Weather Card</h1>
    
    <div class="test-container">
        <h2>Environment Debug</h2>
        <div id="debug-info"></div>
        
        <h2>Card Test</h2>
        <div id="status"></div>
        
        <h3>Card Element</h3>
        <simple-weather-card id="weather-card"></simple-weather-card>
    </div>

    <script>
        const debugDiv = document.getElementById('debug-info');
        const statusDiv = document.getElementById('status');
        
        function addDebug(message, type = 'info') {
            debugDiv.innerHTML += `<div class="status ${type}">${message}</div>`;
        }
        
        function updateStatus(message, isError = false) {
            statusDiv.innerHTML = `<div class="status ${isError ? 'error' : 'success'}">${message}</div>`;
        }
        
        // Debug environment
        addDebug(`window.LitElement: ${typeof window.LitElement}`, window.LitElement ? 'success' : 'error');
        addDebug(`customElements.get('ha-panel-lovelace'): ${typeof customElements.get('ha-panel-lovelace')}`, customElements.get('ha-panel-lovelace') ? 'success' : 'info');
        addDebug(`customElements.get('hc-lovelace'): ${typeof customElements.get('hc-lovelace')}`, customElements.get('hc-lovelace') ? 'success' : 'info');
        
        // Check if any HA components exist
        const haComponents = Array.from(customElements.entries()).filter(([name]) => name.startsWith('ha-'));
        addDebug(`HA Components found: ${haComponents.length}`, haComponents.length > 0 ? 'success' : 'info');
        if (haComponents.length > 0) {
            addDebug(`First few HA components: ${haComponents.slice(0, 5).map(([name]) => name).join(', ')}`, 'debug');
        }
        
        // Load the card script
        const script = document.createElement('script');
        script.type = 'module';
        script.src = './simple-weather-card-bundle.js';
        script.onload = () => {
            addDebug('Card script loaded successfully', 'success');
            
            // Check if custom element is defined
            setTimeout(() => {
                if (customElements.get('simple-weather-card')) {
                    updateStatus('✅ Custom element "simple-weather-card" is registered successfully!');
                    
                    // Test card configuration
                    const card = document.getElementById('weather-card');
                    
                    // Mock Home Assistant data
                    const mockHass = {
                        states: {
                            'weather.home': {
                                entity_id: 'weather.home',
                                state: 'sunny',
                                attributes: {
                                    friendly_name: 'Home Weather',
                                    temperature: 22,
                                    humidity: 65,
                                    pressure: 1013,
                                    wind_speed: 5,
                                    wind_bearing: 180,
                                    forecast: [{
                                        temperature: 25,
                                        templow: 15,
                                        precipitation: 0,
                                        precipitation_probability: 10
                                    }]
                                }
                            },
                            'sun.sun': {
                                state: 'above_horizon'
                            }
                        },
                        config: {
                            unit_system: {
                                temperature: '°C',
                                length: 'km',
                                speed: 'km/h'
                            }
                        },
                        selectedLanguage: 'en',
                        language: 'en',
                        resources: {
                            en: {
                                'component.weather.state._.sunny': 'Sunny',
                                'state.default.unknown': 'Unknown'
                            }
                        },
                        connection: {
                            haVersion: '2024.1.0'
                        }
                    };

                    try {
                        // Configure the card
                        card.setConfig({
                            entity: 'weather.home',
                            name: 'Test Weather',
                            primary_info: ['extrema'],
                            secondary_info: ['precipitation', 'humidity'],
                            backdrop: {
                                day: '#45aaf2',
                                night: '#a55eea',
                                text: '#ffffff',
                                fade: false
                            }
                        });

                        // Set the hass property to trigger rendering
                        card.hass = mockHass;
                        
                        updateStatus('✅ Card configuration and rendering successful!');
                    } catch (error) {
                        updateStatus(`❌ Error configuring card: ${error.message}`, true);
                        console.error('Card configuration error:', error);
                        addDebug(`Error details: ${error.stack}`, 'error');
                    }
                } else {
                    updateStatus('❌ Custom element "simple-weather-card" is NOT registered!', true);
                }
            }, 100);
        };
        
        script.onerror = (error) => {
            addDebug(`Failed to load card script: ${error}`, 'error');
            updateStatus('❌ Failed to load card script!', true);
        };
        
        document.head.appendChild(script);
    </script>
</body>
</html>
